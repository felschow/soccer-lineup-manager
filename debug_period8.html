<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Period 8 - Soccer Lineup Manager</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .debug-section { margin: 20px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .debug-button { margin: 5px; padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; background: #3b82f6; color: white; }
        .debug-result { margin: 10px 0; padding: 15px; border-radius: 6px; background: #f8fafc; border-left: 4px solid #3b82f6; }
        .period-detail { background: #fef9e7; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #f59e0b; }
        .player-count { font-weight: bold; color: #dc2626; }
        .expected { color: #059669; }
        .problem { color: #dc2626; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üîç Period 8 Debug Analysis</h1>
    
    <div class="debug-section">
        <h2>Debug Controls</h2>
        <button class="debug-button" onclick="runDebugAnalysis()">üïµÔ∏è Debug Period 8 Issue</button>
        <button class="debug-button" onclick="analyzeAllPeriods()">üìä Analyze All Periods</button>
    </div>

    <div class="debug-section">
        <h2>Debug Results</h2>
        <div id="debugResults"></div>
    </div>

    <!-- Include all modules -->
    <script src="js/config.js"></script>
    <script src="js/toastManager.js"></script>
    <script src="js/lineupManager.js"></script>
    <script src="js/historyManager.js"></script>
    <script src="js/enhancedStats.js"></script>
    <script src="js/uiManager.js"></script>
    <script src="js/dragDrop.js"></script>
    <script src="js/mobileEnhancements.js"></script>
    <script src="js/autoFill.js"></script>
    <script src="js/exportUtils.js"></script>

    <script>
        // Initialize modules
        document.addEventListener('DOMContentLoaded', () => {
            try {
                ToastManager.init();
                LineupManager.init();
                console.log('Debug environment initialized');
            } catch (error) {
                console.error('Initialization error:', error);
            }
        });

        function runDebugAnalysis() {
            const debugDiv = document.getElementById('debugResults');
            let debugHtml = '';
            
            try {
                // Clear and run algorithm
                LineupManager.clearAllPeriods();
                AutoFillManager.autoFillAll();
                
                debugHtml += '<div class="debug-result"><h3>üîç Period-by-Period Analysis</h3>';
                
                // Analyze each period
                for (let period = 1; period <= 8; period++) {
                    const periodData = LineupManager.lineup[period];
                    const gk = periodData.positions.goalkeeper;
                    const bench = periodData.bench || [];
                    const jersey = periodData.jersey || [];
                    const totalSitting = bench.length + jersey.length;
                    
                    // Count field players
                    const fieldPlayers = [];
                    SoccerConfig.positions.forEach(pos => {
                        if (pos !== 'goalkeeper' && periodData.positions[pos]) {
                            fieldPlayers.push(periodData.positions[pos]);
                        }
                    });
                    
                    const statusClass = totalSitting === 3 ? 'expected' : 'problem';
                    
                    debugHtml += `
                        <div class="period-detail">
                            <h4>Period ${period}</h4>
                            <div><strong>GK:</strong> ${gk}</div>
                            <div><strong>Field Players (${fieldPlayers.length}):</strong> ${fieldPlayers.join(', ')}</div>
                            <div><strong>Bench (${bench.length}):</strong> ${bench.join(', ') || 'None'}</div>
                            <div><strong>Jersey (${jersey.length}):</strong> ${jersey.join(', ') || 'None'}</div>
                            <div class="${statusClass}"><strong>Total Sitting: ${totalSitting}/3 ${totalSitting === 3 ? '‚úÖ' : '‚ùå'}</strong></div>
                            <div><strong>Total Players:</strong> ${fieldPlayers.length + 1 + totalSitting} = ${fieldPlayers.length + 1 + totalSitting === 12 ? '‚úÖ' : '‚ùå'} (should be 12)</div>
                        </div>
                    `;
                }
                
                debugHtml += '</div>';
                
                // Special focus on period 8
                const period8Data = LineupManager.lineup[8];
                const p8bench = period8Data.bench || [];
                const p8jersey = period8Data.jersey || [];
                const p8totalSitting = p8bench.length + p8jersey.length;
                
                debugHtml += `
                    <div class="debug-result">
                        <h3>üéØ Period 8 Detailed Analysis</h3>
                        <div><strong>Expected:</strong> 1 GK + 8 Field Players + 3 Sitting = 12 total</div>
                        <div><strong>Actual:</strong> 1 GK + ? Field Players + ${p8totalSitting} Sitting</div>
                        ${p8totalSitting !== 3 ? '<div class="problem">‚ùå PROBLEM: Not exactly 3 players sitting!</div>' : '<div class="expected">‚úÖ GOOD: Exactly 3 players sitting</div>'}
                    </div>
                `;
                
                // Check algorithm logic
                debugHtml += `
                    <div class="debug-result">
                        <h3>üîß Algorithm Logic Check</h3>
                        <div><strong>Total Players:</strong> ${SoccerConfig.utils.getPlayerNames().length}</div>
                        <div><strong>Period 8 GK:</strong> ${period8Data.positions.goalkeeper}</div>
                        <div><strong>Period 8 Jersey:</strong> ${p8jersey.join(', ') || 'None'}</div>
                        <div><strong>Available for field/bench:</strong> ${SoccerConfig.utils.getPlayerNames().length - 1 - p8jersey.length} players</div>
                        <div><strong>Should be:</strong> 8 field + ${3 - p8jersey.length} bench = ${8 + (3 - p8jersey.length)} total</div>
                    </div>
                `;
                
            } catch (error) {
                debugHtml += `<div class="debug-result problem">‚ùå Error during analysis: ${error.message}</div>`;
            }
            
            debugDiv.innerHTML = debugHtml;
        }

        function analyzeAllPeriods() {
            const debugDiv = document.getElementById('debugResults');
            
            try {
                LineupManager.clearAllPeriods();
                AutoFillManager.autoFillAll();
                
                let html = '<div class="debug-result"><h3>üìä All Periods Summary</h3>';
                
                const violations = [];
                for (let period = 1; period <= 8; period++) {
                    const periodData = LineupManager.lineup[period];
                    const sitting = (periodData.bench || []).length + (periodData.jersey || []).length;
                    
                    if (sitting !== 3) {
                        violations.push(`Period ${period}: ${sitting} sitting`);
                    }
                }
                
                if (violations.length === 0) {
                    html += '<div class="expected">‚úÖ All periods have exactly 3 players sitting!</div>';
                } else {
                    html += '<div class="problem">‚ùå Rule 5 Violations Found:</div>';
                    violations.forEach(v => {
                        html += `<div class="problem">‚Ä¢ ${v}</div>`;
                    });
                }
                
                html += '</div>';
                debugDiv.innerHTML = html;
                
            } catch (error) {
                debugDiv.innerHTML = `<div class="debug-result problem">‚ùå Analysis failed: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>