<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#0f172a">
    <title>Soccer Lineup Manager</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/mobile-improvements.css">
</head>
<body>
    <div class="app-container">
        <!-- Desktop Left Sidebar -->
        <div class="desktop-sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">‚öΩ</div>
                <div class="sidebar-title">Soccer<br>Lineup</div>
            </div>
            
            <div class="sidebar-actions">
                <button class="sidebar-btn primary" onclick="toggleView()" id="viewToggle" title="Toggle between field and table view">
                    <span class="sidebar-icon">üìä</span>
                    <span class="sidebar-label">Table View</span>
                </button>
                
                <button class="sidebar-btn" onclick="autoFillAll()" title="Automatically fill all positions">
                    <span class="sidebar-icon">‚öΩ</span>
                    <span class="sidebar-label">Auto Fill</span>
                </button>
                
                <button class="sidebar-btn secondary" onclick="clearPeriod()" title="Clear current period">
                    <span class="sidebar-icon">üóëÔ∏è</span>
                    <span class="sidebar-label">Clear</span>
                </button>
                
                <button class="sidebar-btn secondary" onclick="exportLineup()" title="Export lineup data">
                    <span class="sidebar-icon">üì§</span>
                    <span class="sidebar-label">Export</span>
                </button>
                
                <button class="sidebar-btn accent" onclick="openTeamManager()" title="Manage team and players">
                    <span class="sidebar-icon">üë•</span>
                    <span class="sidebar-label">Team</span>
                </button>
            </div>
        </div>

        <div class="header">
            <h1>‚öΩ Soccer Lineup Manager</h1>
            
            <div class="period-nav">
                <button onclick="previousPeriod()" id="prevBtn">‚Äπ</button>
                <span class="current-period" id="currentPeriodText">Period 1</span>
                <button onclick="nextPeriod()" id="nextBtn">‚Ä∫</button>
            </div>
        </div>

        <!-- Mobile Period Navigation -->
        <div class="mobile-period-nav">
            <div class="mobile-period-slider">
                <button class="mobile-period-button" onclick="previousPeriod()">‚Äπ</button>
                <div class="mobile-period-display">
                    <div class="mobile-period-title" id="mobilePeriodTitle">Period 1</div>
                    <div class="mobile-period-time" id="mobilePeriodTime">0:00 - 7:30</div>
                </div>
                <button class="mobile-period-button" onclick="nextPeriod()">‚Ä∫</button>
            </div>
        </div>


        <div class="main-content">
            <div class="sidebar">
                <!-- Priority 1: Always Visible - Available Players -->
                <div class="sidebar-section priority-1">
                    <div class="pool-title">
                        üë• Available Players
                    </div>
                    <div class="player-list" id="playerList">
                        <!-- Players will be populated here -->
                    </div>
                </div>

                <!-- Priority 2: Always Visible - Quick Stats -->
                <div class="sidebar-section priority-2">
                    <div class="pool-title">üìä Quick Stats</div>
                    <div id="quickStats">
                        <!-- Stats will be shown here -->
                    </div>
                </div>

                <!-- Priority 3: Collapsible - Timer & Advanced Features -->
                <div class="sidebar-section priority-3 collapsible-section">
                    <div class="pool-title collapsible-header" onclick="toggleSidebarSection('timer')">
                        ‚è±Ô∏è Period Timer
                        <span class="collapse-icon" id="timer-icon">‚àí</span>
                    </div>
                    
                    <div class="collapsible-content" id="timer-content">
                        <!-- Game Timer -->
                        <div class="game-timer">
                            <div class="timer-display" id="gameTimerDisplay">00:00</div>
                            <div class="period-progress">
                                <div class="progress-bar" id="periodProgressBar"></div>
                            </div>
                            <div class="timer-controls">
                                <button class="btn-small" onclick="PeriodTimer.toggleGameTimer()" id="timerToggleBtn">‚ñ∂Ô∏è Start</button>
                                <button class="btn-small" onclick="PeriodTimer.resetGameTimer()">üîÑ Reset</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Priority 4: Collapsible - Period Changes -->
                <div class="sidebar-section priority-4 collapsible-section">
                    <div class="pool-title collapsible-header" onclick="toggleSidebarSection('changes')">
                        üîÑ Next Period Changes
                        <span class="collapse-icon" id="changes-icon">‚àí</span>
                    </div>
                    
                    <div class="collapsible-content" id="changes-content">
                        <div class="period-changes-list" id="periodChangesList">
                            <!-- Period changes will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Mobile-Only: Condensed Timer Widget -->
                <div class="mobile-timer-widget" id="mobileTimerWidget">
                    <div class="mobile-timer-compact">
                        <div class="timer-display-small" id="mobileGameTimerDisplay">00:00</div>
                        <button class="mobile-timer-toggle" onclick="PeriodTimer.toggleGameTimer()" id="mobileTimerToggleBtn">‚ñ∂Ô∏è</button>
                    </div>
                    <div class="mobile-period-progress">
                        <div class="mobile-progress-bar" id="mobilePeriodProgressBar"></div>
                    </div>
                </div>

                <!-- Mobile-Only: Collapsible Period Changes -->
                <div class="mobile-period-changes" id="mobilePeriodChanges">
                    <div class="mobile-collapsible-header" onclick="toggleMobileSection('period-changes')">
                        üîÑ Upcoming Changes
                        <span class="mobile-collapse-icon" id="period-changes-mobile-icon">+</span>
                    </div>
                    <div class="mobile-collapsible-content collapsed" id="period-changes-mobile-content">
                        <div class="mobile-period-changes-list" id="mobilePeriodChangesList">
                            <!-- Period changes will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="field-container" id="fieldView">
                <div class="period-info">
                    <div class="period-title" id="periodTitle">Period 1</div>
                    <div class="period-time" id="periodTime">0:00 - 7:30</div>
                </div>

                <div class="soccer-field">
                    <div class="field-lines">
                        <div class="penalty-area-top"></div>
                        <div class="penalty-area-bottom"></div>
                        <div class="goal-area-top"></div>
                        <div class="goal-area-bottom"></div>
                        <div class="corner-arc top-left"></div>
                        <div class="corner-arc top-right"></div>
                        <div class="corner-arc bottom-left"></div>
                        <div class="corner-arc bottom-right"></div>
                    </div>
                    
                    <div class="position-slot striker" data-position="striker">
                        <div class="position-label">ST</div>
                        <div class="player-name"></div>
                    </div>
                    
                    <div class="position-slot left-wing" data-position="left-wing">
                        <div class="position-label">LW</div>
                        <div class="player-name"></div>
                    </div>
                    
                    <div class="position-slot right-wing" data-position="right-wing">
                        <div class="position-label">RW</div>
                        <div class="player-name"></div>
                    </div>
                    
                    <div class="position-slot center-mid-left" data-position="center-mid-left">
                        <div class="position-label">CM</div>
                        <div class="player-name"></div>
                    </div>
                    
                    <div class="position-slot center-mid-right" data-position="center-mid-right">
                        <div class="position-label">CM</div>
                        <div class="player-name"></div>
                    </div>
                    
                    <div class="position-slot left-back" data-position="left-back">
                        <div class="position-label">LB</div>
                        <div class="player-name"></div>
                    </div>
                    
                    <div class="position-slot center-back" data-position="center-back">
                        <div class="position-label">CB</div>
                        <div class="player-name"></div>
                    </div>
                    
                    <div class="position-slot right-back" data-position="right-back">
                        <div class="position-label">RB</div>
                        <div class="player-name"></div>
                    </div>
                    
                    <div class="position-slot goalkeeper" data-position="goalkeeper">
                        <div class="position-label">GK</div>
                        <div class="player-name"></div>
                    </div>
                </div>

                <div class="bench-area" id="benchArea">
                    <div class="bench-title">ü™ë Sitting Out This Period</div>
                    <div class="empty-message" id="benchEmpty">Drop players here to sit them out</div>
                </div>

                <div class="bench-area" id="jerseyArea" style="border-color: #8B5CF6; background: #F3E8FF;">
                    <div class="bench-title" style="color: #8B5CF6;">üëï Preparing Jersey (Next GK)</div>
                    <div class="empty-message" id="jerseyEmpty" style="color: #8B5CF6;">Drop players here for goalkeeper preparation</div>
                </div>
            </div>

            <!-- Mobile Scaled Soccer Field View -->
            <div class="mobile-soccer-field-scaled" id="mobileFieldViewScaled">
                <div class="mobile-field-lines">
                    <div class="mobile-penalty-area-top"></div>
                    <div class="mobile-penalty-area-bottom"></div>
                    <div class="mobile-goal-area-top"></div>
                    <div class="mobile-goal-area-bottom"></div>
                </div>
                
                <!-- Field Positions (Scaled) -->
                <div class="mobile-position-slot-scaled mobile-striker" data-position="striker">
                    <div class="mobile-position-label-scaled">ST</div>
                    <div class="mobile-player-name-scaled" id="mobile-striker-scaled"></div>
                </div>
                
                <div class="mobile-position-slot-scaled mobile-left-wing" data-position="left-wing">
                    <div class="mobile-position-label-scaled">LW</div>
                    <div class="mobile-player-name-scaled" id="mobile-left-wing-scaled"></div>
                </div>
                
                <div class="mobile-position-slot-scaled mobile-right-wing" data-position="right-wing">
                    <div class="mobile-position-label-scaled">RW</div>
                    <div class="mobile-player-name-scaled" id="mobile-right-wing-scaled"></div>
                </div>
                
                <div class="mobile-position-slot-scaled mobile-center-mid-left" data-position="center-mid-left">
                    <div class="mobile-position-label-scaled">CM</div>
                    <div class="mobile-player-name-scaled" id="mobile-center-mid-left-scaled"></div>
                </div>
                
                <div class="mobile-position-slot-scaled mobile-center-mid-right" data-position="center-mid-right">
                    <div class="mobile-position-label-scaled">CM</div>
                    <div class="mobile-player-name-scaled" id="mobile-center-mid-right-scaled"></div>
                </div>
                
                <div class="mobile-position-slot-scaled mobile-left-back" data-position="left-back">
                    <div class="mobile-position-label-scaled">LB</div>
                    <div class="mobile-player-name-scaled" id="mobile-left-back-scaled"></div>
                </div>
                
                <div class="mobile-position-slot-scaled mobile-center-back" data-position="center-back">
                    <div class="mobile-position-label-scaled">CB</div>
                    <div class="mobile-player-name-scaled" id="mobile-center-back-scaled"></div>
                </div>
                
                <div class="mobile-position-slot-scaled mobile-right-back" data-position="right-back">
                    <div class="mobile-position-label-scaled">RB</div>
                    <div class="mobile-player-name-scaled" id="mobile-right-back-scaled"></div>
                </div>
                
                <div class="mobile-position-slot-scaled mobile-goalkeeper" data-position="goalkeeper">
                    <div class="mobile-position-label-scaled">GK</div>
                    <div class="mobile-player-name-scaled" id="mobile-goalkeeper-scaled"></div>
                </div>
            </div>

            <!-- Mobile Bench Areas (Scaled) -->
            <div class="mobile-bench-area-scaled" id="mobileBenchAreaScaled">
                <div class="mobile-bench-title-scaled">ü™ë Bench Players</div>
                <div class="mobile-bench-slots-scaled">
                    <div class="mobile-bench-slot-scaled" data-position="bench-1" id="mobile-bench-1-scaled">Bench #1</div>
                    <div class="mobile-bench-slot-scaled" data-position="bench-2" id="mobile-bench-2-scaled">Bench #2</div>
                    <div class="mobile-bench-slot-scaled" data-position="bench-3" id="mobile-bench-3-scaled">Bench #3</div>
                </div>
            </div>

            <div class="mobile-bench-area-scaled" id="mobileJerseyAreaScaled">
                <div class="mobile-bench-title-scaled">üëï Jersey Preparation</div>
                <div class="mobile-bench-slots-scaled">
                    <div class="mobile-jersey-slot-scaled" data-position="jersey-1" id="mobile-jersey-1-scaled">Jersey Prep</div>
                </div>
            </div>
        </div>

        <div class="table-view" id="tableView">
            <div class="table-controls">
                <div class="table-title">üìä Complete Game Overview</div>
                <div>
                    <button class="btn btn-secondary" onclick="clearAllPeriods()">Clear All</button>
                    <button class="btn" onclick="autoFillAll()">Auto Fill All</button>
                </div>
            </div>
            
            <table class="lineup-table" id="lineupTable">
                <thead>
                    <!-- Team Header Row -->
                    <tr class="team-header-row" id="tableTeamHeader" style="display: none;">
                        <th colspan="10" class="team-header-cell">
                            <div class="team-info-display">
                                <div class="team-logo-small" id="tableTeamLogo">
                                    <img id="tableTeamLogoImg" alt="Team logo" style="width: 24px; height: 24px; border-radius: 4px; margin-right: 8px; vertical-align: middle;">
                                </div>
                                <span class="team-name-header" id="tableTeamName">
                                    <!-- Team name will be inserted here -->
                                </span>
                            </div>
                        </th>
                    </tr>
                    
                    <!-- Column Headers Row -->
                    <tr>
                        <th>Player</th>
                        <th class="period-header">Period 1<br><small>0:00-7:30</small></th>
                        <th class="period-header">Period 2<br><small>7:30-15:00</small></th>
                        <th class="period-header">Period 3<br><small>15:00-22:30</small></th>
                        <th class="period-header">Period 4<br><small>22:30-30:00</small></th>
                        <th class="period-header">Period 5<br><small>30:00-37:30</small></th>
                        <th class="period-header">Period 6<br><small>37:30-45:00</small></th>
                        <th class="period-header">Period 7<br><small>45:00-52:30</small></th>
                        <th class="period-header">Period 8<br><small>52:30-60:00</small></th>
                        <th>Summary Stats</th>
                    </tr>
                </thead>
                <tbody id="lineupTableBody">
                    <!-- Table rows will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <!-- Team Management Modal -->
    <div class="modal-overlay" id="teamManagerModal" style="display: none;">
        <div class="modal-container team-modal">
            <div class="modal-header">
                <h2 id="teamModalTitle">Team Manager</h2>
                <button class="modal-close" onclick="closeTeamManager()">&times;</button>
            </div>
            
            <div class="modal-content">
                <!-- Team Selection/Creation -->
                <div class="team-section" id="teamSelectionSection">
                    <h3>Select Team</h3>
                    <div class="team-selector">
                        <select id="teamSelect" onchange="handleTeamSelection()">
                            <option value="">-- Select a team --</option>
                        </select>
                        <button class="btn btn-primary" onclick="showCreateTeam()">Create New Team</button>
                    </div>
                    
                    <div class="current-team-info" id="currentTeamInfo" style="display: none;">
                        <div class="team-header">
                            <div class="team-logo-display" id="currentTeamLogo" style="display: none;">
                                <img id="currentTeamLogoImg" alt="Team logo" style="width: 48px; height: 48px; border-radius: 8px; margin-right: 12px;">
                            </div>
                            <div>
                                <h4 id="currentTeamName"></h4>
                                <p id="currentTeamStats"></p>
                            </div>
                        </div>
                        <div class="team-actions">
                            <button class="btn btn-primary" onclick="useCurrentTeam()" id="useTeamBtn">Use This Team</button>
                            <button class="btn btn-secondary" onclick="showEditTeam()">Edit Team</button>
                            <button class="btn btn-danger" onclick="deleteCurrentTeam()">Delete Team</button>
                        </div>
                    </div>
                </div>

                <!-- Team Creation/Editing Form -->
                <div class="team-section" id="teamFormSection" style="display: none;">
                    <h3 id="teamFormTitle">Create New Team</h3>
                    <form id="teamForm" onsubmit="saveTeam(event)">
                        <div class="form-group">
                            <label for="teamNameInput">Team Name:</label>
                            <input type="text" id="teamNameInput" required maxlength="50">
                            <div class="form-error" id="teamNameError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="teamLogoInput">Team Logo:</label>
                            <div class="logo-upload-container">
                                <input type="file" id="teamLogoInput" accept="image/*" onchange="handleLogoUpload(this)">
                                <div class="logo-preview" id="logoPreview" style="display: none;">
                                    <img id="logoPreviewImg" alt="Logo preview" style="width: 64px; height: 64px; border-radius: 8px; margin-top: 8px;">
                                    <button type="button" class="btn-link" onclick="removeLogo()">Remove Logo</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <h4>Players</h4>
                            <div class="players-container">
                                <div class="players-list" id="playersList">
                                    <!-- Players will be added here -->
                                </div>
                                <button type="button" class="btn btn-secondary" onclick="addNewPlayer()">Add Player</button>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="cancelTeamForm()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Team</button>
                        </div>
                    </form>
                </div>

                <!-- Import/Export Section -->
                <div class="team-section">
                    <h3>Import/Export</h3>
                    <div class="import-export-actions">
                        <button class="btn btn-secondary" onclick="exportCurrentTeam()">Export Current Team</button>
                        <input type="file" id="teamImportFile" accept=".json" style="display: none;" onchange="importTeam()">
                        <button class="btn btn-secondary" onclick="document.getElementById('teamImportFile').click()">Import Team</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Timer Page -->
    <div class="mobile-timer-page" id="mobileTimerPage" style="display: none;">
        <div class="mobile-timer-container">
            <!-- Large Timer Display -->
            <div class="mobile-timer-section">
                <div class="mobile-timer-display" id="mobileGameTimerDisplay">00:00</div>
                <div class="mobile-period-info">
                    <div class="mobile-current-period" id="mobileCurrentPeriod">Period 1</div>
                    <div class="mobile-period-time" id="mobilePeriodTime">0:00 - 7:30</div>
                </div>
                <div class="mobile-period-progress">
                    <div class="mobile-progress-bar" id="mobilePeriodProgressBar"></div>
                </div>
            </div>

            <!-- Timer Controls -->
            <div class="mobile-timer-controls">
                <button class="mobile-timer-btn start-pause" onclick="PeriodTimer.toggleGameTimer()" id="mobileTimerToggleBtn">
                    ‚ñ∂Ô∏è Start
                </button>
                <button class="mobile-timer-btn reset" onclick="PeriodTimer.resetGameTimer()">
                    üîÑ Reset
                </button>
            </div>

            <!-- Next Period Changes -->
            <div class="mobile-next-period-section">
                <div class="mobile-section-title">Next Period Changes:</div>
                <div class="mobile-period-changes-list" id="mobilePeriodChangesList">
                    <!-- Period changes will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Menu Modal -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay" style="display: none;">
        <div class="mobile-menu-container">
            <div class="mobile-menu-header">
                <h3>Quick Actions</h3>
                <button class="mobile-menu-close" onclick="hideMobileMenu()">&times;</button>
            </div>
            <div class="mobile-menu-actions">
                <p class="mobile-menu-info">
                    Use the tap-to-assign field interface for managing player positions. 
                    Most actions are available through the bottom navigation or by tapping field positions directly.
                </p>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation (consistent with desktop functions) -->
    <nav class="mobile-bottom-nav">
        <div class="mobile-nav-grid">
            <button class="mobile-nav-button" onclick="toggleView()" id="mobileViewToggle">
                <span class="icon" id="mobileViewIcon">üìä</span>
                <span id="mobileViewText">Table</span>
            </button>
            <button class="mobile-nav-button" onclick="showTimerPage()" id="mobileTimerToggle">
                <span class="icon">‚è±Ô∏è</span>
                <span>Timer</span>
            </button>
            <button class="mobile-nav-button" onclick="openTeamManager()" id="mobileTeamToggle">
                <span class="icon">üë•</span>
                <span>Teams</span>
            </button>
            <button class="mobile-nav-button" onclick="showMobileMenu()" id="mobileMenuToggle">
                <span class="icon">‚ãØ</span>
                <span>More</span>
            </button>
        </div>
    </nav>

    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Application Modules -->
    <script src="js/config.js"></script>
    <script src="js/toastManager.js"></script>
    <script src="js/lineupManager.js"></script>
    <script src="js/historyManager.js"></script>
    <script src="js/enhancedStats.js"></script>
    <script src="js/uiManager.js"></script>
    <script src="js/dragDrop.js"></script>
    <script src="js/mobileEnhancements.js"></script>
    <script src="js/mobileNavigation.js"></script>
    <script src="js/progressiveDisclosure.js"></script>
    <script src="js/mobileUIManager.js"></script>
    <script src="js/mobileTapAssignment.js"></script>
    <script src="js/autoFill.js"></script>
    <script src="js/exportUtils.js"></script>
    <script src="js/teamManager.js"></script>
    <script src="js/teamManagerUI.js"></script>
    <script src="js/periodTimer.js"></script>
    <script src="js/periodTransitionUI.js"></script>
    <script src="js/mobileTimerUI.js"></script>
    <script src="js/app.js"></script>
</body>
</html>